<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>בחר מיקום</title>
<style>
  body { font-family: Arial; margin:0; padding:10px; }
  #map { height: 350px; width: 100%; border:1px solid #ccc; border-radius:8px; }
  #pac-input { width:100%; padding:10px; margin-bottom:10px; font-size:16px; box-sizing:border-box; }
</style>
</head>
<body>

<input id="pac-input" type="text" placeholder="חפש כתובת..." />

<div id="map"></div>

<script>
  const jotformURL = "https://form.jotform.com/253187465582063";

  function sendToJotform(addr, lat, lng) {
    const url = `${jotformURL}?address=${encodeURIComponent(addr)}&lat=${encodeURIComponent(lat)}&lng=${encodeURIComponent(lng)}`;

    // זה יעדכן את פרמטרי ה-URL בתוך הדף של Jotform
    window.parent.location.replace(url);
  }

  function initMap() {
    const start = { lat: 31.7029, lng: 35.1147 }; 

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 14,
      center: start,
    });

    const marker = new google.maps.Marker({
      position: start,
      map: map,
      draggable: true,
    });

    const input = document.getElementById("pac-input");
    const autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.bindTo("bounds", map);

    autocomplete.addListener("place_changed", () => {
      const place = autocomplete.getPlace();
      if (!place.geometry) return;

      if (place.geometry.viewport) {
        map.fitBounds(place.geometry.viewport);
      } else {
        map.setCenter(place.geometry.location);
        map.setZoom(16);
      }

      marker.setPosition(place.geometry.location);

      sendToJotform(
        place.formatted_address,
        place.geometry.location.lat(),
        place.geometry.location.lng()
      );
    });

    google.maps.event.addListener(marker, "dragend", () => {
      const pos = marker.getPosition();

      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ location: pos }, (results, status) => {
        if (status === "OK" && results[0]) {
          sendToJotform(
            results[0].formatted_address,
            pos.lat(),
            pos.lng()
          );
        }
      });
    });
  }
</script>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDh1XXzy1hGTBUrXjtxCVkEnpBq4G0K0tQ&libraries=places&callback=initMap" async defer></script>
</body>
</html>


