<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>בחר מיקום</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    direction: rtl;
  }
  #map {
    width: 100%;
    height: 420px;
    margin-top: 15px;
  }
  #addressBox {
    width: 90%;
    padding: 10px;
    margin: 10px auto;
    font-size: 16px;
  }
  button {
    padding: 12px 20px;
    font-size: 18px;
    margin-top: 12px;
    cursor: pointer;
    background: #4a6cf7;
    color: white;
    border: none;
    border-radius: 8px;
  }
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDh1XXzy1hGTBUrXjtxCVkEnpBq4G0K0tQ&libraries=places"></script>

<script>
let map, marker, geocoder, autocomplete;
let selectedAddress = "";
let selectedLat = "";
let selectedLng = "";

function initMap() {
    geocoder = new google.maps.Geocoder();

    // יצירת המפה
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 31.703, lng: 35.118 },
        zoom: 14
    });

    // חיפוש אוטומטי
    const addressInput = document.getElementById("addressBox");
    autocomplete = new google.maps.places.Autocomplete(addressInput, {
        componentRestrictions: { country: "il" }
    });

    autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry) {
            alert("לא נמצאה כתובת");
            return;
        }

        selectedAddress = place.formatted_address;
        selectedLat = place.geometry.location.lat();
        selectedLng = place.geometry.location.lng();

        placeMarker(place.geometry.location);
    });

    // לחיצה על המפה
    map.addListener("click", function(event) {
        reverseGeocode(event.latLng);
    });
}

function placeMarker(location) {
    if (marker) marker.setMap(null);

    marker = new google.maps.Marker({
        position: location,
        map: map
    });

    map.panTo(location);
}

function reverseGeocode(latlng) {
    geocoder.geocode({ location: latlng }, function(results, status) {
        if (status === "OK" && results[0]) {
            selectedAddress = results[0].formatted_address;
            selectedLat = latlng.lat();
            selectedLng = latlng.lng();

            document.getElementById("addressBox").value = selectedAddress;

            placeMarker(latlng);
        }
    });
}

function submitLocation() {
    if (!selectedAddress) {
        alert("נא לבחור מיקום או להקליד כתובת");
        return;
    }

    const formUrl = "https://forms.fillout.com/t/3MH72AN2ffus";

    const redirectUrl =
        formUrl +
        "?address=" + encodeURIComponent(selectedAddress) +
        "&lat=" + selectedLat +
        "&lng=" + selectedLng;

    window.location.href = redirectUrl;
}
</script>
</head>

<body onload="initMap()">

<h2>בחרי מיקום במפה או הקלידי כתובת</h2>

<input type="text" id="addressBox" placeholder="הקלידי כתובת…" />

<div id="map"></div>

<button onclick="submitLocation()">אישור בלה בלה מיקום</button>

</body>
</html>

